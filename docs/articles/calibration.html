<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model calibration • McMasterPandemic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model calibration">
<meta property="og:description" content="McMasterPandemic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">McMasterPandemic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.19.002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calibration.html">Model calibration</a>
    </li>
    <li>
      <a href="../articles/model.html">The 'McMaster Pandemic' model</a>
    </li>
    <li>
      <a href="../articles/new_getting_started.html">Getting started (markdown version)</a>
    </li>
    <li>
      <a href="../articles/testing_flow.html">Incorporating testing dynamics in the MacPan model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bbolker/McMasterPandemic/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="calibration_files/header-attrs-2.8/header-attrs.js"></script><script src="calibration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model calibration</h1>
                        <h4 class="author">Ben Bolker</h4>
            
            <h4 class="date">2021-05-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbolker/McMasterPandemic/blob/master/vignettes/calibration.rmd"><code>vignettes/calibration.rmd</code></a></small>
      <div class="hidden name"><code>calibration.rmd</code></div>

    </div>

    
    
<p>This document is intended to give a more detailed description (beyond what’s described in the “Getting Started” vignette) of model calibration with MacPan.</p>
<div id="initial-kernel-based-parameter-calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#initial-kernel-based-parameter-calibration" class="anchor"></a>Initial (kernel-based) parameter calibration</h1>
<p>The <code>fix_pars</code> function takes an initial/baseline set of parameters and user-specified values of summary “moments” of the parameters (one or more of the intrinsic growth rate <span class="math inline">\(r\)</span>, the intrinsic reproductive number <span class="math inline">\(R_0\)</span>, and the generation interval <span class="math inline">\(\bar G\)</span>). For each summary metric, the user also gives a set of parameters that are to be adjusted (all by the same multiplier) to achieve the target. The function returns an adjusted set of parameters that correspond to the requested metrics.</p>
<p>This step is useful to get the initial values into a reasonable ballpark, <em>or</em> to adjust parameters that will not be tuned in the full calibration step.</p>
</div>
<div id="breakpoint-based-calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#breakpoint-based-calibration" class="anchor"></a>Breakpoint-based calibration</h1>
<div id="time-varying-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#time-varying-parameters" class="anchor"></a>Time-varying parameters</h2>
<p>In general, time-varying parameters are specified by a data frame (<code>params_timevar</code> argument) of the following form:</p>
<pre><code>        Date Symbol Relative_value
1 2020-03-23  beta0             0.9
2 2020-03-30  beta0             NA
3 2020-04-01  beta0             1.2</code></pre>
<p>where <code>Date</code> is the date of a breakpoint <code>Symbol</code> refers to the name of a value in the parameter vector. If numeric, <code>Relative_value</code> is the relative value (i.e., relative to the value in the baseline <code>params</code> vector) to switch to at the specified date. If <code>NA</code>, the relative value will be a calibrated parameter.</p>
<p>The <code>opt_pars</code> list specifies which parameters to calibrate, and their starting value:</p>
<ul>
<li>the <code>params</code> element specifies starting calibratation values corresponding to elements of the (unlisted?) <code>params</code> vector</li>
<li>the <code>time_params</code> (or <code>[link_]time_params</code>) element specifies starting values for the calibrated values in <code>params_timevar</code> (it should be the same length and for now should match the missing elements by position)</li>
<li>the <code>[link_]nb_disp</code> element specifies calibrated dispersion parameters</li>
</ul>
</div>
<div id="link-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#link-functions" class="anchor"></a>Link functions</h2>
<p>Prepending <code>log_</code> or <code>logit_</code> to a parameter name in <code>opt_pars</code> will automatically specify that it is to be fitted on the corresponding “link” scale (this is the scale on which starting values are specified).</p>
</div>
</div>
<div id="log-linear-calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#log-linear-calibration" class="anchor"></a>Log-linear calibration</h1>
</div>
<div id="computational-details" class="section level1">
<h1 class="hasAnchor">
<a href="#computational-details" class="anchor"></a>Computational details</h1>
<div id="optim-vs-deoptim" class="section level2">
<h2 class="hasAnchor">
<a href="#optim-vs-deoptim" class="anchor"></a>optim vs DEoptim</h2>
</div>
</div>
<div id="obsolete-material" class="section level1">
<h1 class="hasAnchor">
<a href="#obsolete-material" class="anchor"></a>Obsolete material</h1>
<p>Describe model calibration here: by (1) MLE fitting or (2) log-linear regression to exponential-phase data.</p>
<div id="old-phenomenological-log-linear-method" class="section level2">
<h2 class="hasAnchor">
<a href="#old-phenomenological-log-linear-method" class="anchor"></a>OLD (phenomenological) Log-linear method</h2>
<ul>
<li>fit an appropriate statistical model to time-series data (e.g. hospitalization, death, or ICU counts), e.g. negative binomial GLM or (for multiple regions) a GLMM</li>
<li>the log slope is an estimate of <span class="math inline">\(r\)</span>, the log intercept will provide an estimate of initial conditions</li>
<li>the first step of the <code><a href="../reference/calibrate.html">calibrate()</a></code> function takes a given set of baseline parameters and adjusts a specified subset of them (at the moment this is fixed to be (1) the baseline transmission rate and (2) the latent period and infection periods for all but the presymptomatic period) to achieve the observed value of <span class="math inline">\(r\)</span> and one or more other epidemiological characteristics (at present <span class="math inline">\(\bar G\)</span>, the mean generation interval)</li>
<li>the second step first projects the observed intercept (e.g. predicted number of hospitalizations at the beginning of the observation time period) back to the beginning of the simulation time period, then uses the dominant eigenvector of the linearized system to estimate the numbers of other states at that time.</li>
</ul>
<p>The top-level function is <code><a href="../reference/calibrate.html">calibrate()</a></code>: the machinery is in <code>R/calibrate.R</code></p>
<p>Possible calibration issues:</p>
<ul>
<li>effects of nonlinear slopes?</li>
<li>what to do when different data streams have different regression slopes?</li>
<li>if we use a quadratic fit to allow for time-varying beta, how do we feed this back into the simulation?</li>
</ul>
<hr>
<p>Brain dump from e-mail:</p>
<p>Our calibration is/will be based on</p>
<ul>
<li>taking reasonable baseline values of all epi parameters (transmission rate, residence time in various compartments, relative transmission of different compartments, aspects of severity and health utilization …) [right now these are taken from the Stanford covid-interventions model and some conversations from our organizational contact about e.g. fraction ICU, hospital residence times etc. They could easily be adjusted based on regional variation.]</li>
<li>adjusting these parameters to get a mean generation interval and a shape (squared coef of var) that are a match for reasonable values from the literature</li>
<li>doing a log-linear (negative binomial) fit to one or more observed time series (cases, hospitalization, death) to get a value of ‘r’; adjust base transmission rate to match this r <strong>JD: I still don’t know how we can adjust beta0 without screwing up Gbar?</strong>, if necessary using numerical optimization to get the same desired values of G etc. at the same time</li>
<li>use the log-slope and log-intercept of the fit in previous step to set initial conditions, seting the <em>relative</em> numbers in compartments according to the dominant eigenvector of the Jacobian. This is where underreporting comes in: e.g. if you’re calibrating from confirmed cases, you need to guess the ratio between cases and true I. If you’re calibrating from reported COVID deaths, you should scale your true initial conditions to take this into account.</li>
</ul>
<p>Note that we could fake a testing lag (for now) by simple post-hoc adjustment of case times vs. other times. Don’t yet have a good solution for dependence of case numbers on testing intensity though (see <code>testing_flow.md</code>).</p>
</div>
<div id="priors" class="section level2">
<h2 class="hasAnchor">
<a href="#priors" class="anchor"></a>priors</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Bolker, David Earn, Morgan Kain, Mike Li, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
