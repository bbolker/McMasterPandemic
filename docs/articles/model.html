<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The 'McMaster Pandemic' model • McMasterPandemic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The 'McMaster Pandemic' model">
<meta property="og:description" content="McMasterPandemic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">McMasterPandemic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.19.002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calibration.html">Model calibration</a>
    </li>
    <li>
      <a href="../articles/model.html">The 'McMaster Pandemic' model</a>
    </li>
    <li>
      <a href="../articles/new_getting_started.html">Getting started (markdown version)</a>
    </li>
    <li>
      <a href="../articles/testing_flow.html">Incorporating testing dynamics in the MacPan model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bbolker/McMasterPandemic/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_files/header-attrs-2.8/header-attrs.js"></script><script src="model_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The ‘McMaster Pandemic’ model</h1>
                        <h4 class="author">Ben Bolker</h4>
            
            <h4 class="date">2021-05-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbolker/McMasterPandemic/blob/master/vignettes/model.rmd"><code>vignettes/model.rmd</code></a></small>
      <div class="hidden name"><code>model.rmd</code></div>

    </div>

    
    
<div id="model-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#model-structure" class="anchor"></a>model structure</h2>
<p>The “McMasterPandemic” model is a compartmental model built for the purposes of modeling the COVID-19 pandemic. Its main features are:</p>
<ul>
<li>moderate epidemiological complexity, incorporating asymptomatic and presymptomatic infectious classes as well as subdividing symptomatic infections into moderate and severe</li>
<li>health-care utilization structure, including acute-care and ICU compartments</li>
<li>structure for calibrating to data</li>
<li>flexibility in incorporating time-varying parameters</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/McMasterPandemic">McMasterPandemic</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/vis_model.html">vis_model</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"diagram"</span>,do_symbols<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="model_files/figure-html/diag1-1.png" width="700"></p>
<pre><code>## NULL</code></pre>
</div>
<div id="basic-operation-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-operation-simulation" class="anchor"></a>basic operation (simulation)</h2>
</div>
<div id="time-varying-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#time-varying-parameters" class="anchor"></a>time-varying parameters</h2>
<div id="breakpoints" class="section level3">
<h3 class="hasAnchor">
<a href="#breakpoints" class="anchor"></a>breakpoints</h3>
</div>
<div id="log-linear-models" class="section level3">
<h3 class="hasAnchor">
<a href="#log-linear-models" class="anchor"></a>log-linear models</h3>
<p>The</p>
<div id="splines" class="section level4">
<h4 class="hasAnchor">
<a href="#splines" class="anchor"></a>splines</h4>
</div>
</div>
<div id="calibration" class="section level3">
<h3 class="hasAnchor">
<a href="#calibration" class="anchor"></a>calibration</h3>
</div>
</div>
<div id="model-expansion" class="section level2">
<h2 class="hasAnchor">
<a href="#model-expansion" class="anchor"></a>model expansion</h2>
<div id="testing-and-tracing" class="section level3">
<h3 class="hasAnchor">
<a href="#testing-and-tracing" class="anchor"></a>Testing and tracing</h3>
<p>To incorporate testing and tracing mechanistically, we have expanded the basic model in order to be able to</p>
<ul>
<li>continue to make use of case reporting data (positive test confirmations per day) without having the results confounded by variation in testing intensity (by incorporating both positive and negative tests into our calibration);</li>
<li>facilitate analysis of scenarios involving changes in testing intensity and contact tracing.</li>
</ul>
<p>Our basic approach is to add an additional set of compartments to our model, expanding each compartment into the following sub-compartments:</p>
<ul>
<li>
<em>untested</em> (<code>_u</code> extension) People with negative test results move back into this category since they can be tested again if there are new reasons for the test.</li>
<li>
<em>tested, awaiting report, sample is negative</em> (<code>_n</code> extension) either because the tested individual was uninfected, or because of a lack of test sensitivity. We can assign compartment-specific probabilities of a positive test (low for <span class="math inline">\(S\)</span> [currently set as 0], high for <span class="math inline">\(I\)</span> compartments [currently set as 1], and possibly lower for non-symptomatic/early stages than for later stages).</li>
<li>
<em>tested, awaiting report, sample is positive</em> (<code>_p</code> extensions) either because the tested individual was infected, or because of a lack of test specificity.</li>
<li>
<em>tested positive</em> (<code>_t</code> extension) Individuals who have a positive test will not be tested again, and may change their behaviour (isolate), depending on degree of compliance to public health advice.</li>
</ul>
<p>In addition to these compartments, we also add <em>accumulator compartments</em> for negative and positive test reports. The appropriate accumulator is incremented at an appropriate time.</p>
<ul>
<li>If test results are indexed to the time of sampling then the accumulators are incremented during the <code>_u</code> to <code>_n</code> and <code>_u</code> to <code>_p</code> transitions</li>
<li>If test results are indexed to the time of reporting then the accumulators are incremented during the <code>_n</code> to <code>_u</code> and <code>_p</code> to <code>_t</code> transitions</li>
</ul>
<p>We can then recover the daily numbers of negative and positive tests recorded by differencing the cumulative totals (and add observation error if desired).</p>
<pre><code>## Loading required package: shape</code></pre>
<p><img src="model_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>Individuals can also move between epidemiological compartments while awaiting test results, e.g. from “presymptomatic, awaiting positive test results” (<code>Ip_p</code>) to “mild infection, awaiting positive test results” (<code>Im_p</code>). This does not change their testing status, except that when untested, severely symptomatic individuals are hospitalized for COVID, we assume they are tested immediately (i.e. `</p>
<p>In order to reflect the range of possible testing strategies, we assign a <em>testing weight</em> to each compartment in the model that specifies what fraction of the current testing intensity is allocated to that compartment. We take the current testing intensity <span class="math inline">\(T\)</span> (overall per capita tests/day) as a model input. Then, given testing weights <span class="math inline">\(w_i\)</span>, the *per capita} rate at which individuals in epidemiological compartment <span class="math inline">\(i\)</span> move from <code>_u</code> to <code>_n</code> or <code>_p</code> (awaiting test results) is <span class="math display">\[\begin{equation}
\frac{T w_i}{\sum_j w_j P_j} \,,
\end{equation}\]</span> where <span class="math inline">\(P_j\)</span> is the proportion of the population in compartment <span class="math inline">\(i\)</span>. The weights depend on the testing strategy and population state in complicated ways; if only confirmatory testing is being done (no screening or contact tracing or surveillance testing), then the weights will be skewed toward symptomatic compartments – although not entirely, as observed test positivity rarely goes above 20%, and sensitivity is thought to be much higher than this. More contact tracing will increase the weights of non-symptomatically infected people. More random-surveillance testing will make the weights of all the groups more similar.</p>
<p>Including the testing structure increases the number of compartments substantially, and consequently yields a much larger flow matrix</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/vis_model.html">vis_model</a></span><span class="op">(</span>testify<span class="op">=</span><span class="cn">TRUE</span>,aspect<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span></code></pre></div>
<p><img src="model_files/figure-html/vis_testify-1.png" width="700"></p>
<p>Explicit testing structure is enabled if the parameter vector/list contains an element <code>testing_intensity</code> which is set &gt;0. (As a side note, if you are using <code><a href="../reference/read_params.html">read_params("PHAC_testify.csv")</a></code> to capture our most recent set of default parameters, and you <em>don’t</em> want an explicit-testing model, you should use <code><a href="https://rdrr.io/r/stats/update.html">update(., testing_intensity=0)</a></code>.) The argument <code>testing_time</code> to the <code><a href="../reference/make_ratemat.html">make_ratemat()</a></code> function determines when testing is counted (“sample” or “report”); this can be passed to <code><a href="../reference/run_sim.html">run_sim()</a></code> (or from farther upstream) in the <code>ratemat_args</code> (list) argument; the default is to set counting time to “sample”, with a warning.</p>
</div>
</div>
<div id="age-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#age-structure" class="anchor"></a>age structure</h2>
<ul>
<li>we can construct a larger rate matrix</li>
<li>how does beta work? Suppose we have <span class="math inline">\(n_a\)</span> age categories and <span class="math inline">\(n_I\)</span> infectious categories (e.g. <span class="math inline">\(I_a\)</span>, <span class="math inline">\(I_p\)</span>, <span class="math inline">\(I_m\)</span> etc.) We want a beta matrix with dimensions <span class="math inline">\(n_a \times (n_a n_I)\)</span> (because there is only one <span class="math inline">\(S\)</span> compartment per age category, at least until we introduce testing)</li>
</ul>
</div>
<div id="goals" class="section level2">
<h2 class="hasAnchor">
<a href="#goals" class="anchor"></a>goals</h2>
<p>The ability to simulate/forecast</p>
<ul>
<li>time and height of peak health utilization (acute care, ICU beds, ventilators) regionally and locally</li>
<li>testing</li>
<li>ability to model local differences in epidemic curves based on locale-specific information (e.g. age-demographics, population density, etc.)</li>
<li>estimation of <span class="math inline">\(R(t)\)</span>!</li>
</ul>
</div>
<div id="why-another-simulator" class="section level2">
<h2 class="hasAnchor">
<a href="#why-another-simulator" class="anchor"></a>why another simulator?</h2>
<p>Given the <a href="http://tinyurl.com/covid19-models">large number of available simulators</a>, why did we write another one?</p>
<ul>
<li>maybe laziness/stubbornness</li>
<li>desire for a flexible and clear model structure that might nevertheless go beyond existing models (age and geographic structure were higher priority goals when we started)</li>
</ul>
</div>
<div id="platform" class="section level2">
<h2 class="hasAnchor">
<a href="#platform" class="anchor"></a>Platform</h2>
<p>Familiarity/convenience/speed and ease of implementation, debugging, maintenance are most important. For us, this rules out Julia and Python and strongly suggests R. Speed may eventually be important, for (1) running stochastic replicates and varying-parameter ensembles and (2) incorporating the model in simulation-based estimation methods (ABC, iterated filtering/<code>pomp</code>). If we are focused on estimation, we have a choice among Gibbs-based platforms (NIMBLE, JAGS) and platforms that only allow continuous latent variables (TMB, Stan).</p>
<ul>
<li>
<strong>Estimation</strong>: TMB, Stan, NIMBLE, pomp + ?, ABC + ?</li>
<li>
<strong>Forward simulation</strong>: we could write in base R or try to couple with something faster (e.g. <code>odin</code>, <code>Rcpp</code>). Lots of possibilities for vectorization and matrix operations to speed up base R implementations, although some operations like convolution might be hard to vectorize. <code>pomp</code> provides a <a href="http://kingaa.github.io/pomp/manual/csnippet.html">Csnippets</a> interface (used by the “COVID interventions” project). I am tempted by <code>odin</code>, a platform that allows translation/compilation in C++ via an R-like syntax, e.g. see the <a href="https://cran.R-project.org/package=odin/vignettes/discrete.html">discrete-simulation vignette</a>
</li>
</ul>
</div>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<div id="compartmental-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#compartmental-structure" class="anchor"></a>Compartmental structure</h3>
<ul>
<li>we need at least SEIR + hospitalization, ICU</li>
<li>probably important to include asymptomatic and presymptomatic compartments as well</li>
<li>may want to include compartments that model the testing as well as the treatment pipeline</li>
<li>deaths</li>
</ul>
</div>
<div id="interventions" class="section level3">
<h3 class="hasAnchor">
<a href="#interventions" class="anchor"></a>Interventions</h3>
<p>Some of these are simple. Want to set up general structure for importing a dated list of changes in parameters (date, focal parameter, new value or proportional change). Testing rates can be included as part of this “non-autonomous”/forcing/external part of the parameterization.</p>
</div>
<div id="parameterization" class="section level3">
<h3 class="hasAnchor">
<a href="#parameterization" class="anchor"></a>Parameterization</h3>
<ul>
<li>get parameters from existing model implementations</li>
<li>list from MIDAS web page</li>
<li>age-specific death rates (Hubei) – from Riou et al. <a href="https://www.medrxiv.org/content/10.1101/2020.03.04.20031104v1.full.pdf" class="uri">https://www.medrxiv.org/content/10.1101/2020.03.04.20031104v1.full.pdf</a>
</li>
<li>Hospitalization parameters: <a href="https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(20)30566-3/fulltext" class="uri">https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(20)30566-3/fulltext</a>
</li>
</ul>
</div>
<div id="asymptomaticundetected-cases" class="section level3">
<h3 class="hasAnchor">
<a href="#asymptomaticundetected-cases" class="anchor"></a>Asymptomatic/undetected cases</h3>
<ul>
<li>could try to integrate new testing-distribution framework?</li>
<li>specify underreporting probability (ad hoc), beta-binomial process</li>
<li>time-varying reporting probability?</li>
<li>related to compartment structure, testing/intervention</li>
</ul>
</div>
<div id="stochasticity" class="section level3">
<h3 class="hasAnchor">
<a href="#stochasticity" class="anchor"></a>Stochasticity</h3>
<ul>
<li>demographic stochasticity ([beta]binomial, Poisson/NB)</li>
<li>autoregressive variation in parameters? (important for estimation)</li>
<li>iteration over parameter uncertainty (hypercube/Sobol/etc.)</li>
</ul>
</div>
<div id="geographic-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#geographic-structure" class="anchor"></a>Geographic structure</h3>
<ul>
<li>including spatial structure at the local level doesn’t seem too hard. Has implications for size of state vector/speed (mitigated by a vectorized/matrix-based set of machinery?), and raises questions about parameterization (spatial variation in parameters, travel/contact matrix)</li>
</ul>
</div>
<div id="age-structure-1" class="section level3">
<h3 class="hasAnchor">
<a href="#age-structure-1" class="anchor"></a>Age structure</h3>
<ul>
<li>important for predictions of health care utilization/severity</li>
<li>also for effects of interventions (school, work closures, etc.): use info from Prem et al. 2013 WAIFW matrices divided by activity {school, home, work, other} (DOI: <code>10.1371/journal.pcbi.1005697</code>; machine-readable info at <a href="https://doi.org/10.1371/journal.pcbi.1005697.s002" class="uri">https://doi.org/10.1371/journal.pcbi.1005697.s002</a>)</li>
<li>interactions with space? can use “other” category WAIFW matrix only (Kronecker product)</li>
</ul>
</div>
<div id="delay-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#delay-distributions" class="anchor"></a>Delay distributions</h3>
<p>(not sure how important this is?)</p>
<ul>
<li>most existing methods are using exponential periods</li>
<li>Erlang/linear chain?</li>
<li>generation intervals/convolution</li>
</ul>
<p>Disadvantages of linear-chain and convolution models are speed and potentially complexity/transparency (modeling convolution with GI handles arbitrary distribution of infectiousness over time, but making it interact with testing and treatment pipelines seems complicated?)</p>
</div>
</div>
<div id="relevant-existing-models-see-model-list" class="section level2">
<h2 class="hasAnchor">
<a href="#relevant-existing-models-see-model-list" class="anchor"></a>Relevant existing models (see <a href="https://tinyurl.com/covid19-models">model list</a>)</h2>
<ul>
<li>Covid19tauleapmodel [compartments, interventions, age, parameters]</li>
<li>COVID_interventions [compartments, interventions, parameters] Uses “Csnippet” (pomp-style C code) for speed.</li>
<li>CSH-covid19 <a href="#interventions">interventions</a>
</li>
<li>Riou et al. [compartments, parameters, age, estimation] (but slow: uses ODEs in Stan, ~ 1 day run time)</li>
<li>Song lab [estimation?] (but some weird statistical choices?)</li>
<li>Georgia CEID</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Bolker, David Earn, Morgan Kain, Mike Li, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
