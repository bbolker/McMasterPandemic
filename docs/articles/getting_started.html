<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • McMasterPandemic</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="McMasterPandemic">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">McMasterPandemic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calibration.html">Model calibration</a>
    </li>
    <li>
      <a href="../articles/farr.html">Cumulative curves, Farr's law, and all that</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/model.html">The 'McMaster Pandemic' model</a>
    </li>
    <li>
      <a href="../articles/testing_flow.html">Incorporating testing dynamics in the MacPan model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bbolker/McMasterPandemic/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="getting_started_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
                        <h4 class="author">Ben Bolker</h4>
            
            <h4 class="date">2021-05-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bbolker/McMasterPandemic/blob/master/vignettes/getting_started.Rmd"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
% % %
<p>\begin{document} </p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Use  to install the latest version of the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/McMasterPandemic">McMasterPandemic</a></span><span class="op">)</span></code></pre></div>
<p>In this vignette we’ll also use some other packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>; <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="data-requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#data-requirements" class="anchor"></a>Data requirements</h2>
<p>To run simulations, a few parameter values must be specified. Set these by editing the example params file, which is converted to a  object by . In the example, the time unit is assumed to be days.</p>
<p>The term <code>in acute care'' means</code>in hospital but not in the intensive care unit (ICU)’’.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_params.html">read_params</a></span><span class="op">(</span><span class="st">"ICU1.csv"</span><span class="op">)</span></code></pre></div>
<p> (by default  looks first in the working directory for CSV files, then in the  directory installed with the package (). All the built-in parameter files can be found as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"params"</span>, package<span class="op">=</span><span class="st">"McMasterPandemic"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">folder</span><span class="op">)</span>
<span class="co">#&gt; [1] "CI_base.csv"             "CI_updApr1.csv"         </span>
<span class="co">#&gt; [3] "ICU_diffs.csv"           "ICU1.csv"               </span>
<span class="co">#&gt; [5] "midas_estimates.csv"     "midas_estimates_ali.csv"</span>
<span class="co">#&gt; [7] "PHAC.csv"                "PHAC_testify.csv"       </span>
<span class="co">#&gt; [9] "stanford_estimates.csv"</span></code></pre></div>
<p> If you want to edit one of these files, you need to copy it to your working directory first. To find the full path to , for example, use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"params/ICU1.csv"</span>, package<span class="op">=</span><span class="st">"McMasterPandemic"</span><span class="op">)</span>
<span class="co">#&gt; [1] "C:/Users/somat/AppData/Local/Temp/RtmpQFZbMs/temp_libpathd10285647a3/McMasterPandemic/params/ICU1.csv"</span></code></pre></div>
<p>If  is a parameter set (e.g., the result of ), then  or, equivalently,  will return a data frame with a column giving the meaning of each parameter.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/describe_params.html">describe_params</a></span><span class="op">(</span><span class="va">params1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">symbol</th>
<th align="left">value</th>
<th align="left">meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">beta0</td>
<td align="left">1</td>
<td align="left">Baseline (non-intervention) transmission across categories</td>
</tr>
<tr class="even">
<td align="left">Ca</td>
<td align="left">0.667</td>
<td align="left">relative asymptomatic transmission (or contact)</td>
</tr>
<tr class="odd">
<td align="left">Cp</td>
<td align="left">1</td>
<td align="left">relative presymptomatic transmission (or contact)</td>
</tr>
<tr class="even">
<td align="left">Cm</td>
<td align="left">1</td>
<td align="left">relative mildly symptomatic transmission (or contact)</td>
</tr>
<tr class="odd">
<td align="left">Cs</td>
<td align="left">1</td>
<td align="left">relative severely symptomatic transmission (or contact)</td>
</tr>
<tr class="even">
<td align="left">alpha</td>
<td align="left">0.333</td>
<td align="left">Fraction of cases asymptomatic</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="left">0.192</td>
<td align="left">1/time in exposed class</td>
</tr>
<tr class="even">
<td align="left">gamma_a</td>
<td align="left">0.143</td>
<td align="left">1/time for asymptomatic recovery</td>
</tr>
<tr class="odd">
<td align="left">gamma_m</td>
<td align="left">0.143</td>
<td align="left">1/time for mildly symptomatic recovery</td>
</tr>
<tr class="even">
<td align="left">gamma_s</td>
<td align="left">0.175</td>
<td align="left">1/time for severely symptomatic transition to hospital/death</td>
</tr>
<tr class="odd">
<td align="left">gamma_p</td>
<td align="left">2</td>
<td align="left">1/time in pre-symptomatic class</td>
</tr>
<tr class="even">
<td align="left">rho</td>
<td align="left">0.1</td>
<td align="left">1/time in hospital (acute care)</td>
</tr>
<tr class="odd">
<td align="left">delta</td>
<td align="left">0</td>
<td align="left">Fraction of acute-care cases that are fatal</td>
</tr>
<tr class="even">
<td align="left">mu</td>
<td align="left">0.956</td>
<td align="left">Fraction of symptomatic cases that are mild (or moderate)</td>
</tr>
<tr class="odd">
<td align="left">N</td>
<td align="left">1e+06</td>
<td align="left">Population size</td>
</tr>
<tr class="even">
<td align="left">E0</td>
<td align="left">5</td>
<td align="left">Initial number exposed</td>
</tr>
<tr class="odd">
<td align="left">nonhosp_mort</td>
<td align="left">0</td>
<td align="left">probability of mortality without hospitalization</td>
</tr>
<tr class="even">
<td align="left">iso_m</td>
<td align="left">0</td>
<td align="left">Relative self-isolation/distancing of mild cases</td>
</tr>
<tr class="odd">
<td align="left">iso_s</td>
<td align="left">0</td>
<td align="left">Relative self-isolation/distancing of severe cases</td>
</tr>
<tr class="even">
<td align="left">phi1</td>
<td align="left">0.76</td>
<td align="left">Fraction of hospital cases to acute care</td>
</tr>
<tr class="odd">
<td align="left">phi2</td>
<td align="left">0.5</td>
<td align="left">Fraction of ICU cases dying</td>
</tr>
<tr class="even">
<td align="left">psi1</td>
<td align="left">0.05</td>
<td align="left">Rate of ICU back to acute care</td>
</tr>
<tr class="odd">
<td align="left">psi2</td>
<td align="left">0.125</td>
<td align="left">Rate of ICU to death</td>
</tr>
<tr class="even">
<td align="left">psi3</td>
<td align="left">0.2</td>
<td align="left">Rate of post-ICU to discharge</td>
</tr>
<tr class="odd">
<td align="left">c_prop</td>
<td align="left">0.1</td>
<td align="left">fraction of incidence reported as positive tests</td>
</tr>
<tr class="even">
<td align="left">c_delay_mean</td>
<td align="left">11</td>
<td align="left">average delay between incidence and test report</td>
</tr>
<tr class="odd">
<td align="left">c_delay_cv</td>
<td align="left">0.25</td>
<td align="left">coefficient of variation of testing delay</td>
</tr>
<tr class="even">
<td align="left">proc_disp</td>
<td align="left">0</td>
<td align="left">dispersion parameter for process error (0=demog stoch only)</td>
</tr>
<tr class="odd">
<td align="left">zeta</td>
<td align="left">0</td>
<td align="left">phenomenological heterogeneity parameter</td>
</tr>
</tbody>
</table>
<p>The  method for  objects returns the initial exponential growth rate (<span class="math inline">\(r_0\)</span>), the doubling time (<span class="math inline">\(\log{2}/r_0\)</span>), the mean generation interval (<span class="math inline">\(\overline{G}\)</span>), and the basic reproduction number</p>
<p>%% <span class="math display">\[\begin{equation*}
\R_0 = \beta_0 \left\{
\alpha \frac{C_{\rm a}}{\gamma_{\rm a}}
+
(1-\alpha)\left[ \frac{C_{\rm p}}{\gamma_{\rm p}}
  + \mu(1-\texttt{iso}_{\rm m})\frac{C_{\rm m}}{\gamma_{\rm m}}
  + (1-\mu)(1-\texttt{iso}_{\rm s})\frac{C_{\rm s}}{\gamma_{\rm s}} \right]
  \right\} \,.
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">params1</span><span class="op">)</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">r0</th>
<th align="right">R0</th>
<th align="right">Gbar</th>
<th align="right">CFR_gen</th>
<th align="right">dbl_time</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.23</td>
<td align="right">6.52</td>
<td align="right">12.19</td>
<td align="right">0.04</td>
<td align="right">3.04</td>
</tr></tbody>
</table>
<p> The components of <span class="math inline">\(\R_0\)</span> (the reproduction number associated with each infectious compartment) can also be extracted.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_R0.html">get_R0</a></span><span class="op">(</span><span class="va">params1</span>, components<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">asymptomatic</th>
<th align="right">pre-symptomatic</th>
<th align="right">mild</th>
<th align="right">severe</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">1.56</td>
<td align="right">0.33</td>
<td align="right">4.46</td>
<td align="right">0.17</td>
</tr></tbody>
</table>
<p>The initial state must also be set, but it is sufficient to specify the parameter set (a  object), in which case the population size and initially exposed population will be taken from the parameters (in this case all non-exposed individuals are assumed to be susceptible).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">state1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_state.html">make_state</a></span><span class="op">(</span>params<span class="op">=</span><span class="va">params1</span><span class="op">)</span></code></pre></div>
<p>Dates on which the simulation starts and ends must be stated. If there are no observations that you are aiming to match, then these dates are arbitrary and only the length of time matters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sdate</span> <span class="op">&lt;-</span> <span class="st">"2020-02-10"</span>
<span class="va">edate</span> <span class="op">&lt;-</span> <span class="st">"2020-06-01"</span></code></pre></div>
</div>
<div id="sec:run_sim" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:run_sim" class="anchor"></a>Running a simulation</h2>
<p>A simple deterministic simulation is run as follows, and returns a  object. The  method computes the times and magnitudes of peak demands on acute care (H) and intenstive care (ICU), and the basic reproduction number <span class="math inline">\(\R_0\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span>params<span class="op">=</span><span class="va">params1</span>, state<span class="op">=</span><span class="va">state1</span>, start_date<span class="op">=</span><span class="va">sdate</span>, end_date<span class="op">=</span><span class="va">edate</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span>
<span class="co">#&gt;   peak_ICU_date peak_ICU_val peak_H_date peak_H_val       R0</span>
<span class="co">#&gt; 1    2020-04-19         2787  2020-04-18       8094 6.518009</span></code></pre></div>
<p>The  method for  objects returns a  object, optionally on a log scale.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,  <span class="co">## logarithmic</span>
          <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span><span class="op">)</span>  <span class="co">## linear</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_sim-1.png" width="768"></p>
<div id="stochasticity" class="section level3">
<h3 class="hasAnchor">
<a href="#stochasticity" class="anchor"></a>Stochasticity</h3>
<p>The effects of observation error are easy to explore with the  argument to . The  parameter is the dispersion parameter for a  (if the mean and variance are <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>, respectively, then <span class="math inline">\(\sigma^2=\mu + \frac{\mu^2}{\text{obs_disp}}\)</span>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span>
<span class="va">params1obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">params1</span>, obs_disp<span class="op">=</span><span class="fl">200</span><span class="op">)</span>
<span class="va">res1obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span><span class="va">params1obs</span>, <span class="va">state1</span>, start_date<span class="op">=</span><span class="va">sdate</span>, end_date<span class="op">=</span><span class="va">edate</span>,
                   stoch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>obs<span class="op">=</span><span class="cn">TRUE</span>, proc<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res1obs</span><span class="op">)</span>
<span class="co">#&gt;   peak_ICU_date peak_ICU_val peak_H_date peak_H_val       R0</span>
<span class="co">#&gt; 1    2020-04-19         2840  2020-04-18       8701 6.518009</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1obs</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1obs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/run_sim_obs_noise-1.png" width="768"></p>
<p>To simulate with process error, use . By default, this simulates only demographic stochasticity, which has little effect in a large epidemic.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params1proc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">params1</span>,E0<span class="op">=</span><span class="fl">200</span>,proc_disp<span class="op">=</span><span class="fl">0</span><span class="op">)</span>  <span class="co">## demog stoch only</span>
<span class="va">res1proc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span><span class="va">params1proc</span>, start_date<span class="op">=</span><span class="va">sdate</span>, end_date<span class="op">=</span><span class="va">edate</span>,
                    stoch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>obs<span class="op">=</span><span class="cn">FALSE</span>, proc<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Making  positive simulates with additional process noise:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params1proc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">params1</span>,E0<span class="op">=</span><span class="fl">200</span>, proc_disp<span class="op">=</span><span class="fl">0.5</span>, obs_disp<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="va">res1proc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span><span class="va">params1proc2</span>, start_date<span class="op">=</span><span class="va">sdate</span>, end_date<span class="op">=</span><span class="va">edate</span>,
                    stoch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>obs<span class="op">=</span><span class="cn">FALSE</span>, proc<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1proc2</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">res1proc2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/proc2-1.png" width="700"></p>
<p>Demographic noise is included by calculating probabilities from the rates and then drawing a multinomial sample to determine how many individuals move from one compartment to each of the others. With pure demographic noise, the CV is very small with only <span class="math inline">\(\sim1000\)</span> individuals moving among compartments. Process dispersion (; <code>overdispersed demographic stochasticity'') is implemented using \code{pomp::reulermultinom}, which adds gamma white noise to the event rates.  For some discussion of this, see p.\,274 and Appendix~A of the</code>plug-and-play’’ paper by He <em>et al.</em> (2010,  {}, 271–283, <a href="doi:%5Ctexttt%7B10.1098/rsif.2009.0151" class="uri">doi:\texttt{10.1098/rsif.2009.0151</a>}. </p>
</div>
<div id="time-dependent-transmission-rate" class="section level3">
<h3 class="hasAnchor">
<a href="#time-dependent-transmission-rate" class="anchor"></a>Time-dependent transmission rate</h3>
<p>Implementing known changes in transmission rate (e.g., resulting from social distancing measures) is straighforward via the  argument. The following reduces <span class="math inline">\(\beta_0\)</span> (and hence <span class="math inline">\(\R_0\)</span>) to 50% of its original value on 10 March 2020, and to 10% of its original value on 25 March 2020.</p>
<p>Setting  forces 20 intermediate time steps to occur between each saved step. (Try it with  to see why this is a good idea.)</p>
<p>Setting  retains all variables in the output, rather than collapsing into a single <span class="math inline">\(I\)</span> class <em>etc.</em></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">time_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-03-10"</span>,<span class="st">"2020-03-25"</span><span class="op">)</span>,
                      Symbol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta0"</span>,<span class="st">"beta0"</span><span class="op">)</span>,
                      Relative_value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">restimedep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span><span class="va">params1</span>,<span class="va">state1</span>,start_date<span class="op">=</span><span class="va">sdate</span>,end_date<span class="op">=</span><span class="va">edate</span>,
                      params_timevar<span class="op">=</span><span class="va">time_pars</span>,ndt<span class="op">=</span><span class="fl">20</span>, condense<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">restimedep</span><span class="op">)</span>
<span class="co">#&gt;   peak_ICU_date peak_ICU_val peak_H_date peak_H_val       R0</span>
<span class="co">#&gt; 1    2020-04-10          415  2020-04-08       1175 6.518009</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">restimedep</span>, log<span class="op">=</span><span class="cn">TRUE</span>, condense<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">restimedep</span>, condense<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/run_sim_time-dependent_beta0-1.png" width="768"></p>
</div>
</div>
<div id="changing-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#changing-parameters" class="anchor"></a>Changing parameters</h2>
<p>Some parameters you might wish to change are not directly available in the parameter file. Instead, you can adjust them using . For example, if you would like to change the default value of <span class="math inline">\(\R_0\)</span> implied in the parameter list  you can do the following.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">params1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         r0         R0       Gbar    CFR_gen   dbl_time </span>
<span class="co">#&gt;  0.2278149  6.5180089 12.1897402  0.0352000  3.0425898</span>
<span class="co">## Change R0 to 2</span>
<span class="va">newparams1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_pars.html">fix_pars</a></span><span class="op">(</span><span class="va">params1</span>, target<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>R0<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">newparams1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;          r0          R0        Gbar     CFR_gen    dbl_time </span>
<span class="co">#&gt;  0.06649208  2.00002038 12.18974018  0.03520000 10.42450796</span></code></pre></div>
</div>
<div id="calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h2>
<p>In a typical epidemic forecasting application, we have imperfect information about the parameters and a time series of reported events (e.g., cases, hospitalizations, deaths, <em>etc.</em>). Our goal is to predict the future course of the outbreak, and to determine how it will differ under various intervention scenarios.</p>
<p>The natural approach is to find a set of parameters that lies within the estimated constraints and best fits the observed part of the epidemic. This is referred to as ``calibrating’’ the model to the data.</p>
<p>Unsurprisingly, there is a function  for doing just this.</p>
<p>Imagine that the simulated data saved in  were the observed data to which want to fit the model. We can calibrate to these data as follows.</p>
<p>Note that  requires the data come in <code>long form'', which means that for each date on which we have data, there are separate rows for each type of data (report, death, hospitalization, *etc*).  This is in contrast to</code>wide form’’, for which there is one row for each date, and separate columns for each observed variable.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">## pull out only the reported cases and convert to long form:</span>
<span class="va">report_data</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res1obs</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"report"</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span>, <span class="va">var</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">report_data</span><span class="op">)</span>
<span class="co">#&gt;          date value    var</span>
<span class="co">#&gt; 16 2020-02-25     1 report</span>
<span class="co">#&gt; 17 2020-02-26     3 report</span>
<span class="co">#&gt; 18 2020-02-27     1 report</span>
<span class="co">#&gt; 19 2020-02-28     1 report</span>
<span class="co">#&gt; 20 2020-02-29     2 report</span>
<span class="co">#&gt; 21 2020-03-01     2 report</span>
<span class="co">## beta0 is the only parameter we're going to optimize:</span>
<span class="va">opt_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta0<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="co">## fit beta0 based on the report data:</span>
<span class="va">fitted.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">report_data</span>
  , start_date <span class="op">=</span> <span class="va">sdate</span>
    <span class="co">## skip breaks that are present by default:</span>
  , time_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>break_dates <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  , base_params <span class="op">=</span> <span class="va">params1obs</span>
  , opt_pars <span class="op">=</span> <span class="va">opt_pars</span>
  <span class="co">##, debug_plot = TRUE # instructive plotting during optimization</span>
<span class="op">)</span>
<span class="co">## plot the resulting fit</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitted.mod</span>, data<span class="op">=</span><span class="va">report_data</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/calibrateTOres1obs-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## spit out fitted parameters (in this case, just beta0)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitted.mod</span>, <span class="st">"fitted"</span><span class="op">)</span>
<span class="co">#&gt; $params</span>
<span class="co">#&gt;    beta0 </span>
<span class="co">#&gt; 0.999375</span></code></pre></div>
<p> That worked well, given that the value of  used for the simulation was 1. You might want to try running the above interactive without commenting out ``’’. This will allow you to see the process of fitting the model to the data. Note, however, that this instructive visualization of the optimization process will slow down the optimization by an order of magnitude.</p>
<p>Let’s now now try to fit the model to both reports and deaths. It is easiest to create the required long-form data frame using the  function in the  package.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="va">report_death_data</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res1obs</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">report</span>, <span class="va">death</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"var"</span>, <span class="op">-</span><span class="va">date</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">report_death_data</span>, n<span class="op">=</span><span class="fl">12</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 12 x 3</span>
<span class="co">#&gt;    date       var   value</span>
<span class="co">#&gt;    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2020-02-11 death     0</span>
<span class="co">#&gt;  2 2020-02-12 death     0</span>
<span class="co">#&gt;  3 2020-02-13 death     0</span>
<span class="co">#&gt;  4 2020-02-14 death     0</span>
<span class="co">#&gt;  5 2020-02-15 death     0</span>
<span class="co">#&gt;  6 2020-02-16 death     0</span>
<span class="co">#&gt;  7 2020-02-17 death     0</span>
<span class="co">#&gt;  8 2020-02-18 death     0</span>
<span class="co">#&gt;  9 2020-02-19 death     0</span>
<span class="co">#&gt; 10 2020-02-20 death     0</span>
<span class="co">#&gt; 11 2020-02-21 death     0</span>
<span class="co">#&gt; 12 2020-02-22 death     0</span></code></pre></div>
<p>Now let’s fit to both reports and deaths.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## beta0 is the only parameter we're going to optimize:</span>
<span class="va">opt_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta0<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fitted.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">report_death_data</span>
  , start_date <span class="op">=</span> <span class="va">sdate</span>
    <span class="co">## skip breaks that are present by default:</span>
  , time_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>break_dates <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  , base_params <span class="op">=</span> <span class="va">params1obs</span>
  , opt_pars <span class="op">=</span> <span class="va">opt_pars</span>
  <span class="co">##, debug_plot = TRUE # instructive plotting during optimization</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitted.mod</span>, data<span class="op">=</span><span class="va">report_death_data</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/calibrateTOres1obs_both_reports_and_deaths-1.png" width="700">  If you wish, you can plot just the data being fitted, and the fitted model, via:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitted.mod</span>, data<span class="op">=</span><span class="va">report_death_data</span>,
     predict_args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>keep_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"report"</span>,<span class="st">"death"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_report_and_death_only-1.png" width="700">  That fit looks remarkably good. Let’s see how good:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitted.mod</span>, <span class="st">"fitted"</span><span class="op">)</span> <span class="co"># spit out fitted parameters</span>
<span class="co">#&gt; $params</span>
<span class="co">#&gt; beta0 </span>
<span class="co">#&gt;     1</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitted.mod</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         r0         R0       Gbar    CFR_gen   dbl_time </span>
<span class="co">#&gt;  0.2278149  6.5180089 12.1897402  0.0352000  3.0425898</span></code></pre></div>
<p> Amazing: our fitted  is exactly the value used in the simulation that generated the data. Note that in the summary at the end,  refers to the initial exponential growth rate from the fitted model. This provides an alternative to the  package for fitting epidemic growth rates.</p>
<p>Finally, consider the case where we have both observation and process noise. Fitting to these data won’t do as well, because  does not have a way of fitting to process noise. Consequently, the quality of our fit can be expected to be worse. Of course, real data always contain process noise</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report_data</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res1proc2</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span>, var<span class="op">=</span><span class="st">"report"</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span>, <span class="va">var</span><span class="op">)</span>
    <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">## beta0 is the only parameter we're going to optimize:</span>
<span class="va">opt_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta0<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fitted.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">report_data</span>
  , start_date <span class="op">=</span> <span class="va">sdate</span>
    <span class="co">## skip breaks that are present by default:</span>
  , time_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>break_dates <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  , base_params <span class="op">=</span> <span class="va">params1proc2</span>
  , opt_pars <span class="op">=</span> <span class="va">opt_pars</span>
  <span class="co">##, debug_plot = TRUE # instructive plotting during optimization</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitted.mod</span>, data<span class="op">=</span><span class="va">report_data</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/calibrateTOres1proc2-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitted.mod</span>, <span class="st">"fitted"</span><span class="op">)</span> <span class="co"># spit out fitted parameters</span>
<span class="co">#&gt; $params</span>
<span class="co">#&gt;   beta0 </span>
<span class="co">#&gt; 0.90125</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitted.mod</span>,<span class="st">"all"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;         r0         R0       Gbar    CFR_gen   dbl_time </span>
<span class="co">#&gt;  0.2106971  5.8743555 12.1897402  0.0352000  3.2897798</span></code></pre></div>
<p> As above, you can plot just the data being fitted, and the fitted model, via:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitted.mod</span>, data<span class="op">=</span><span class="va">report_data</span>, predict_args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>keep_vars<span class="op">=</span><span class="st">"report"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_report_only-1.png" width="700"></p>
<div id="troubleshooting-calibrations" class="section level3">
<h3 class="hasAnchor">
<a href="#troubleshooting-calibrations" class="anchor"></a>Troubleshooting calibrations</h3>
<p>If you find that the fitted model trajectory is peculiarly jagged, the likely culprit is the time step. In this case, increase the number of internal time steps per time step (), via adding  to your  call, e.g. .</p>
<p> You may need to experiment with  to get a smooth result.</p>
</div>
</div>
<div id="scenario-exploration" class="section level2">
<h2 class="hasAnchor">
<a href="#scenario-exploration" class="anchor"></a>Scenario exploration</h2>
<p>Typically, after calibrating to observed data, you are likely to be interested in forecasting what might happen in the future, under various scenarios of possible changes in control measures/policies. Here, we give an example involving changing the transmission rate (<span class="math inline">\(\beta\)</span>) in the future.</p>
<p>First we load some data manipulation packages for convenience.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p> Now we modify the  example (). We first check that setting  and using non-  yield the same results.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_params.html">read_params</a></span><span class="op">(</span><span class="st">"ICU1.csv"</span><span class="op">)</span>
<span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_pars.html">fix_pars</a></span><span class="op">(</span><span class="va">params</span>, target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>R0 <span class="op">=</span> <span class="fl">1.3</span>, Gbar<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_state.html">make_state</a></span><span class="op">(</span>params<span class="op">=</span><span class="va">pp</span><span class="op">)</span>
<span class="va">startdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>
<span class="va">enddate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-01"</span><span class="op">)</span></code></pre></div>
<p> This is checking if we can get the same thing if we don’t add stoch:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sim.html">run_sim</a></span><span class="op">(</span><span class="va">pp</span>,<span class="va">state</span>,start_date<span class="op">=</span><span class="va">startdate</span>,end_date<span class="op">=</span><span class="va">enddate</span><span class="op">)</span>
<span class="va">gg0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sim0</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>
    <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">incidence</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg0</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/check_get_same_thing-1.png" width="700">  We want a dataframe that includes the time varying relative <span class="math inline">\(\beta\)</span> at each saved time point. If relative <span class="math inline">\(\beta\)</span> is constant though time, it should give back the same trajectory.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">time_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">:</span><span class="va">enddate</span><span class="op">)</span>
    , Symbol<span class="op">=</span><span class="st">"beta0"</span>
    , Relative_value<span class="op">=</span><span class="fl">1</span>
<span class="op">)</span>
    <span class="co"># , stringsAsFactors=FALSE)</span></code></pre></div>
<p> This fits a  dataframe where :</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim0_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">sim0</span>, params_timevar<span class="op">=</span><span class="va">time_pars</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg0</span>
    <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim0_t</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>,y<span class="op">=</span><span class="va">incidence</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/timevar-1.png" width="700">  Now, as an example, we set relative <span class="math inline">\(\beta\)</span> to drop by a factor of 2 (linearly) between 1 July 2020 and 1 Oct 2020.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lockdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-07-01"</span><span class="op">)</span>
<span class="va">time_pars2</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">:</span><span class="va">enddate</span><span class="op">)</span>
             , Symbol<span class="op">=</span><span class="st">"beta0"</span>
             , Relative_value <span class="op">=</span>
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">:</span><span class="va">lockdown</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
                   , <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lockdown</span><span class="op">:</span><span class="va">enddate</span><span class="op">)</span><span class="op">)</span>
                     <span class="op">)</span>
               <span class="op">)</span>
<span class="co">##print(time_pars2)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">time_pars2</span><span class="op">)</span>
<span class="co">#&gt;         Date Symbol Relative_value</span>
<span class="co">#&gt; 1 2020-01-01  beta0              1</span>
<span class="co">#&gt; 2 2020-01-02  beta0              1</span>
<span class="co">#&gt; 3 2020-01-03  beta0              1</span>
<span class="co">#&gt; 4 2020-01-04  beta0              1</span>
<span class="co">#&gt; 5 2020-01-05  beta0              1</span>
<span class="co">#&gt; 6 2020-01-06  beta0              1</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim0_t_reduce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">sim0</span>, params_timevar<span class="op">=</span><span class="va">time_pars2</span><span class="op">)</span>
<span class="va">gg_rel_beta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">time_pars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span>
    <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Relative_value</span><span class="op">)</span><span class="op">)</span>
    <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">time_pars2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Date</span>, y<span class="op">=</span><span class="va">Relative_value</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p> We can now look at the relative value of <span class="math inline">\(\beta\)</span> in each scenario, and the corresponding forecasted epidemic curves.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg_rel_beta</span><span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_rel_beta-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg0</span>
        <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sim0_t_reduce</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>,y<span class="op">=</span><span class="va">incidence</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="getting_started_files/figure-html/plot_rel_beta-2.png" width="700"></p>
<p>\end{document}</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Bolker, David Earn, Morgan Kain, Mike Li, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
